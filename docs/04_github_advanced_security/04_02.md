---
title: '2. Prevent secrets from being stored in code'
layout: default
nav_order: 2
parent: 'Exercise 04: Secure development with GitHub Advanced Security'
---

# Task 02 - Prevent secrets from being stored in code

## Description

GitHub Advanced Security includes secret scanning. In this task you will see how your security configuration prevents secrets from being introduced into a GitHub repository. 

## Success Criteria

- You have prevented secrets from being added to your repository 

## Learning Resources

## Key Tasks

### 01: Add secrets to the solution 

To verify the security settings related to secrets, you will add one or more secrets to the solution code or appsettings.json file. 

<details markdown="block">
<summary><strong>Expand this section to see detailed steps</strong></summary>

1. Go to the solution in Visual Studio Code.

2. Open the `src/appsettings.json` file. Add the following settings (secrets) and save the changes:

```json
    "secrets": {
    "jwtToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.tUzxCMLwTxp-0p3X4s0v9LQxwPjzdpDn0ZfU2U3lZbw",
    "users": [
      { "username": "admin", "password": "password123" },
      { "username": "user", "password": "p@ssw0rd" }
    ],
    "database": {
      "connectionString": "Server=myServerAddress;Database=myDataBase;User Id=myUsername;Password=myPassword;",
      },
      "apiKeys": {
        "googleMaps": "AIzaSyD4f5g6H7i8J9k0LmNOpQrStUvWxYz1234",
        "weatherService": "WTHR-5678-ABCD-EFGH-IJKL"
      
    }
```
3. Open the `/src/Controllers/CartController.cs` file. Add the following variables (secrets) to the class and save the changes: 

```chsharp
   public class CartController : Controller
    {
        string sendgrid-api-key = "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";
        string stripe-api-key = "sk_live_xf2fh0Hu3LqXlqqUg2DEWhEz";
        string twilio-api-key = "SK575796bb721246b5fe003bcc32ebde77";
        string username-password-uri = "https://username:password@example.com";

        ...
    }
```

</details>

### 02: Try to commit the changes 

In this task you will observe GitHub Advanced Security settings preventing you from committing code that contains detected secrets. Create at least one secret in in `src/appsettings.json` and `src/Controllers/CartController.cs`.

Commit the changes from the previous task and push them to your current branch. As you push you should see an error rejecting the commit:

```bash
! [remote rejected] docs -> docs (push declined due to repository rule violations)
error: failed to push some refs to 'https://github.com/zava-ai-lab/zava-ai-devops-copilot.git'
```
This works because you have the organization setup for secrets protection.
![GitHub organization secrets configuration](../../media/0402_secrets_config.png)


<details markdown="block">
<summary><strong>Expand this section to see detailed steps</strong></summary>

From Terminal, issue the commands to add your changes and commit:

```bash
git add .
git commit -m 'adding secrets'
git push
```

The output, after you attempt to push, should be similar to the following:

```bash
remote: error: GH013: Repository rule violations found for refs/heads/docs.
remote: 
remote: - GITHUB PUSH PROTECTION
remote:   —————————————————————————————————————————
remote:     Resolve the following violations before pushing again
remote: 
remote:     - Push cannot contain secrets
remote: 
remote:     
remote:      (?) Learn how to resolve a blocked push
remote:      https://docs.github.com/code-security/secret-scanning/working-with-secret-scanning-and-push-protection/working-with-push-protection-from-the-command-line#resolving-a-blocked-push
remote:     
remote:     
remote:       —— SendGrid API Key ——————————————————————————————————
remote:        locations:
remote:          - commit: 8a85a78ffbbea35245eb8f10d31c4d61a3c67457
remote:            path: docs/04_github_advanced_security/04_02.md:54
remote:     
remote:        (?) To push, remove secret from commit(s) or follow this URL to allow the secret.
remote:        https://github.com/zava-ai-lab/zava-ai-devops-copilot/security/secret-scanning/unblock-secret/357RRVPmRYYKAyqJB2LmlAO0Wx6
remote:     
remote:     
remote:       —— Stripe API Key ————————————————————————————————————
remote:        locations:
remote:          - commit: 8a85a78ffbbea35245eb8f10d31c4d61a3c67457
remote:            path: docs/04_github_advanced_security/04_02.md:55
remote:     
remote:        (?) To push, remove secret from commit(s) or follow this URL to allow the secret.
remote:        https://github.com/zava-ai-lab/zava-ai-devops-copilot/security/secret-scanning/unblock-secret/357W5rcBKDcJy8YgBQJvcOLkH1M
remote:     
remote:     
remote:       —— Twilio API Key ————————————————————————————————————
remote:        locations:
remote:          - commit: 8a85a78ffbbea35245eb8f10d31c4d61a3c67457
remote:            path: docs/04_github_advanced_security/04_02.md:56
remote:     
remote:        (?) To push, remove secret from commit(s) or follow this URL to allow the secret.
remote:        https://github.com/zava-ai-lab/zava-ai-devops-copilot/security/secret-scanning/unblock-secret/357W5nO8Za6LqmKpSfvmHA8e5yt

https://github.com/zava-ai-lab/zava-ai-devops-copilot.git
 ! [remote rejected] docs -> docs (push declined due to repository rule violations)
error: failed to push some refs to 'https://github.com/zava-ai-lab/zava-ai-devops-copilot.git'

```
</details>

### 03: Remove the secrets from the solution code

You will now delete the secrets that you created in `src/appsettings.json` and `src/Controllers/CartController.cs`. Save the changes and try once again to commit and push the changes to your current branch.

You will still see the message indicating the push is rejected. This time it is because the commit history still includes the secrets. Reset the commit history to remove the secrets with the following two commands:

```bash
git reset --hard HEAD~1
git reset --hard HEAD~1
```
Once you have done this, you will be able to push changes to this branch so long as there are no secrets in the commit.
